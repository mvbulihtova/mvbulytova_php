<!-- 1. –ü–æ –∑–∞—Ö–æ–¥—É –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∑–∞–ø–∏—à–∏—Ç–µ –≤ —Å–µ—Å—Å–∏—é —Ç–µ–∫—Å—Ç 'test'. 
–ó–∞—Ç–µ–º –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –≤—ã–≤–µ–¥–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–µ—Å—Å–∏–∏ –Ω–∞ —ç–∫—Ä–∞–Ω. -->

<?php
session_start();
if (!isset($_SESSION['text'])) {
    $_SESSION['text'] = 'test';
    echo "–¢–µ–∫—Å—Ç –∑–∞–ø–∏—Å–∞–Ω –≤ —Å–µ—Å—Å–∏—é. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.";
} else {
    echo "–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–µ—Å—Å–∏–∏: " . $_SESSION['text'].'<BR><BR>';
}


// 3. –°–¥–µ–ª–∞–π—Ç–µ —Å—á–µ—Ç—á–∏–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º. 
// –î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω–∏—Ç–µ –≤ —Å–µ—Å—Å–∏–∏. –°–∫—Ä–∏–ø—Ç –¥–æ–ª–∂–µ–Ω –≤—ã–≤–æ–¥–∏—Ç—å –Ω–∞ —ç–∫—Ä–∞–Ω –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π. 
// –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞—Ö–æ–¥–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–Ω –¥–æ–ª–∂–µ–Ω –≤—ã–≤–µ—Å—Ç–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Ç–æ–º, —á—Ç–æ –≤—ã –µ—â–µ –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É.


if (!isset($_SESSION['refresh_count'])) {
    // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—à–µ–ª –≤–ø–µ—Ä–≤—ã–µ
    $_SESSION['refresh_count'] = 0;
    echo "–í—ã –µ—â—ë –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª–∏ —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É.";
} else {
    // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á—ë—Ç—á–∏–∫ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
    $_SESSION['refresh_count']++;
    echo "–í—ã –æ–±–Ω–æ–≤–∏–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É {$_SESSION['refresh_count']} —Ä–∞–∑(–∞).".'<BR><BR>';
}


// 5. –ó–∞–ø–∏—à–∏—Ç–µ –≤ —Å–µ—Å—Å–∏—é –≤—Ä–µ–º—è –∑–∞—Ö–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Å–∞–π—Ç. 
// –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤—ã–≤–æ–¥–∏—Ç–µ —Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –Ω–∞–∑–∞–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—à–µ–ª –Ω–∞ —Å–∞–π—Ç.

if (!isset($_SESSION['login_time'])) {
    // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞—Ö–æ–¥–µ
    $_SESSION['login_time'] = time();
    echo "–í—ã —Ç–æ–ª—å–∫–æ —á—Ç–æ –∑–∞—à–ª–∏ –Ω–∞ —Å–∞–π—Ç.".'<BR><BR>';
} else {
    // –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É —Ç–µ–∫—É—â–∏–º –≤—Ä–µ–º–µ–Ω–µ–º –∏ –≤—Ä–µ–º–µ–Ω–µ–º –≤—Ö–æ–¥–∞
    $seconds = time() - $_SESSION['login_time'];
    echo "–í—ã –∑–∞—à–ª–∏ –Ω–∞ —Å–∞–π—Ç $seconds —Å–µ–∫—É–Ω–¥ –Ω–∞–∑–∞–¥.".'<BR><BR>';
}


// 6. –°–ø—Ä–æ—Å–∏—Ç–µ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è email —Å –ø–æ–º–æ—â—å—é —Ñ–æ—Ä–º—ã. 
// –ó–∞—Ç–µ–º —Å–¥–µ–ª–∞–π—Ç–µ —Ç–∞–∫, —á—Ç–æ–±—ã –≤ –¥—Ä—É–≥–æ–π —Ñ–æ—Ä–º–µ (–ø–æ–ª—è: –∏–º—è, —Ñ–∞–º–∏–ª–∏—è, –ø–∞—Ä–æ–ª—å, email) 
// –ø—Ä–∏ –µ–µ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø–æ–ª–µ email –±—ã–ª–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ.

if (isset($_POST['step']) && $_POST['step'] === 'email') {
    $_SESSION['user_email'] = $_POST['email'] ?? '';
}

// –ü–æ–ª—É—á–∞–µ–º email –∏–∑ —Å–µ—Å—Å–∏–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
$email = $_SESSION['user_email'] ?? '';

// –ï—Å–ª–∏ email –µ—â—ë –Ω–µ –≤–≤–µ–¥—ë–Ω ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—É—é —Ñ–æ—Ä–º—É
if (empty($email)): ?>
    <!-- –§–æ—Ä–º–∞ 1: –∑–∞–ø—Ä–æ—Å email -->
    <form method="post">
        <label>–í–≤–µ–¥–∏—Ç–µ email:</label>
        <input type="email" name="email" required>
        <input type="hidden" name="step" value="email">
        <button type="submit">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
    </form>

<?php else: ?>
    <!-- –§–æ—Ä–º–∞ 2: —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å –∞–≤—Ç–æ–ø–æ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–º email -->
    <form method="post">
        <label>–ò–º—è:</label>
        <input type="text" name="firstname" required><br>

        <label>–§–∞–º–∏–ª–∏—è:</label>
        <input type="text" name="lastname" required><br>

        <label>–ü–∞—Ä–æ–ª—å:</label>
        <input type="password" name="password" required><br>

        <label>Email:</label>
        <input type="email" name="email" value="<?= htmlspecialchars($email) ?>" required><br>

        <button type="submit">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
    </form>
<?php endif; ?>

<!-- 8. –£–¥–∞–ª–∏—Ç–µ –∫—É–∫—É —Å –∏–º–µ–Ω–µ–º test. -->
<?php
setcookie('test', '', time() - 3600);
echo "–ö—É–∫–∞ 'test' —É–¥–∞–ª–µ–Ω–∞.".'<BR><BR>';

// 10. –°–ø—Ä–æ—Å–∏—Ç–µ –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. 
// –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞—Ö–æ–¥–µ –Ω–∞ —Å–∞–π—Ç –Ω–∞–ø–∏—à–∏—Ç–µ —Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π –æ—Å—Ç–∞–ª–æ—Å—å –¥–æ –µ–≥–æ –¥–Ω—è —Ä–æ–∂–¥–µ–Ω–∏—è. 
// –ï—Å–ª–∏ —Å–µ–≥–æ–¥–Ω—è –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - –ø–æ–∑–¥—Ä–∞–≤—å—Ç–µ –µ–≥–æ!

if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['birthdate'])) {
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DD
    setcookie('birthdate', $_POST['birthdate'], time() + (365 * 24 * 60 * 60)); // –Ω–∞ 1 –≥–æ–¥
    header('Location: ' . $_SERVER['PHP_SELF']);
    exit;
}

// –ï—Å–ª–∏ –∫—É–∫–∞ —É–∂–µ –µ—Å—Ç—å
if (isset($_COOKIE['birthdate'])) {
    $today = new DateTime();
    $birthdate = new DateTime($_COOKIE['birthdate']);

    // –î–µ–Ω—å –∏ –º–µ—Å—è—Ü –∏–∑ –¥–∞—Ç—ã —Ä–æ–∂–¥–µ–Ω–∏—è
    $nextBirthday = DateTime::createFromFormat('Y-m-d', $today->format('Y') . '-' . $birthdate->format('m-d'));

    // –ï—Å–ª–∏ –î–† —É–∂–µ –ø—Ä–æ—à—ë–ª –≤ —ç—Ç–æ–º –≥–æ–¥—É ‚Äî –ø–µ—Ä–µ–Ω–æ—Å–∏–º –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π
    if ($nextBirthday < $today) {
        $nextBirthday->modify('+1 year');
    }

    $interval = $today->diff($nextBirthday);
    $days = $interval->days;

    // –í—ã–≤–æ–¥–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ
    if ($days === 0) {
        echo "üéâ –° –¥–Ω—ë–º —Ä–æ–∂–¥–µ–Ω–∏—è! üéâ";
    } else {
        echo "–î–æ –≤–∞—à–µ–≥–æ –¥–Ω—è —Ä–æ–∂–¥–µ–Ω–∏—è –æ—Å—Ç–∞–ª–æ—Å—å $days –¥–Ω–µ–π.";
    }
} else {
    // –§–æ—Ä–º–∞ –¥–ª—è –≤–≤–æ–¥–∞ –¥–∞—Ç—ã —Ä–æ–∂–¥–µ–Ω–∏—è
    echo '
    <form method="post">
        <label>–í–≤–µ–¥–∏—Ç–µ –≤–∞—à—É –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è:</label>
        <input type="date" name="birthdate" required>
        <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </form>';
}
?>